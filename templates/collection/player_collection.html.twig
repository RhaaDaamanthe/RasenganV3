{% extends 'base.html.twig' %}

{% block title %}Collection de {{ user.pseudo }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
{% endblock %}

{% block body %}
    <main class="main-collec-responsive">
        <h2 id="Catalogue">Chez {{ user.pseudo }}</h2>
        <input type="text" id="searchbar" placeholder="Recherche un personnage, un animÃ©, une sÃ©rie ou un film"/>

        <div class="filters-container">
            <div class="filters">
                <div class="filter-group">
                    <label for="sectionFilter">ðŸ“š Section</label>
                    <select id="sectionFilter">
                        <option value="all">Toutes les sections</option>
                        <option value="anime">AnimÃ©s</option>
                        <option value="film">Films & sÃ©ries</option>
                    </select>
                </div>
            
                <div class="filter-group">
                    <label for="rarityFilter">ðŸŒŸ RaretÃ©</label>
                    <select id="rarityFilter">
                        <option value="">Toutes les raretÃ©s</option>
                        <option value="Events">Ã‰vÃ©nements</option>
                        <option value="Mythiques">Mythiques</option>
                        <option value="Legendaires">LÃ©gendaires</option>
                        <option value="Epiques">Ã‰piques</option>
                        <option value="Rares">Rares</option>
                        <option value="Communes">Communes</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="catalogue2">
    {% set allUserCards = userCardAnimes|merge(userCardFilms) %}
    
    {% if allUserCards is empty %}
        <p>{{ user.pseudo }} n'a aucune carte dans son inventaire.</p>
    {% else %}
        {% for userCard in allUserCards %}
            {% if userCard.cardAnime is defined and userCard.cardAnime is not null %}
                {% set card = userCard.cardAnime %}
                {% set section = 'anime' %}
            {% elseif userCard.cardFilm is defined and userCard.cardFilm is not null %}
                {% set card = userCard.cardFilm %}
                {% set section = 'film' %}
            {% else %}
                {% set card = null %}
            {% endif %}

            {% if card is not null %}
                <div class="card" 
                     data-section="{{ section }}"
                     data-anime="{{ card.anime.nom ?? '' }}"
                     data-film="{{ card.film.nom ?? '' }}"
                     {# LIGNE CORRIGÃ‰E : on utilise l'ID de raretÃ© ici pour les clics #}
                     data-rarete="{{ card.rarity.id ?? '' }}"
                     {# NOUVEL ATTRIBUT : on ajoute le nom de la raretÃ© pour les filtres #}
                     data-rarity-name="{{ card.rarity.libelle ?? '' }}">
                    <img src="{{ asset(card.imagePath) }}" alt="{{ card.nom }}">
                    <div class="card-content">
                        <h2 class="card-title">{{ userCard.quantity }}</h2>
                        {% if card.description %}
                            <p>{{ card.description|raw }}</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>
    </main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/filtre_cartes.js') }}"></script>
{% endblock %}