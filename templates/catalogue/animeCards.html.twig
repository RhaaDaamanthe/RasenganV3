{% extends 'base.html.twig' %}

{% block title %}
    {% if anime is defined %}
        Cartes de l'anim√© {{ anime.nom }}
    {% else %}
        Toutes les cartes
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}" />
{% endblock %}

{% block body %}
    <main>
        <input type="text" id="searchbar" placeholder="Recherche un personnage ou un anim√©."/>
        <div class="filters-container">
            <div class="filters">
                <div class="filter-group">
                    <label for="rarityFilter">üåü Raret√©</label>
                    <select id="rarityFilter">
                    <option value="">Toutes les raret√©s</option>
                    <option value="Events">Events</option>
                    <option value="Mythiques">Mythiques</option>
                    <option value="Legendaires">L√©gendaires</option>
                    <option value="Epiques">√âpiques</option>
                    <option value="Rares">Rares</option>
                    <option value="Communes">Communes</option>
                </select>
                </div>
            </div>
        </div>
        <div class="catalogue2">
            {% for card in cards %}
                {% if card.anime is not null %}
                    {# Correction ici pour utiliser le libell√© de la raret√© au lieu de l'ID #}
                    <div class="card" data-anime="{{ card.anime.nom }}" data-rarete="{{ card.rarity.id }}">
                        {% if card.imagePath %}
                            <img src="{{ asset(card.imagePath) }}" alt="{{ card.nom }}">
                        {% else %}
                            <img src="{{ asset('images/placeholder.png') }}" alt="{{ card.nom }}">
                        {% endif %}
                        <div class="card-content">
                            {% set total_owned = 0 %}
                            {% for userCard in card.userCardAnimes %}
                                {% set total_owned = total_owned + userCard.quantity %}
                            {% endfor %}
                            
                            {% if card.rarity.id in [4, 5, 6] %}
                                <h2 class="card-title">
                                    {% if card.userCardAnimes|length > 0 and card.userCardAnimes|first.user is defined %}
                                        {{ card.userCardAnimes|first.user.pseudo }}
                                    {% else %}
                                        Aucun
                                    {% endif %}
                                </h2>
                            {% else %}
                                <h2 class="card-title">
                                    {{ total_owned }} / {{ card.quantity ?? 0 }}
                                </h2>

                                <ul class="owners-list" style="display:none;">
                                    {% if card.userCardAnimes|length > 0 %}
                                        {% for userCard in card.userCardAnimes %}
                                            <li>{{ userCard.user.pseudo }} (x{{ userCard.quantity }})</li>
                                        {% endfor %}
                                    {% else %}
                                        <li>Aucun propri√©taire</li>
                                    {% endif %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/utilisateurs_cartes.js') }}"></script>
    <script src="{{ asset('js/filtre_cartes.js') }}"></script>
{% endblock %}